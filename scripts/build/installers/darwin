#!/usr/bin/env bash

set -ex

export OS=darwin
export ARCH=x64

source ./scripts/_init

extra_args=()
if [[ ! -z "${OSX_KEYCHAIN:-}" ]]; then
    extra_args+=(
        "--sign" "Developer ID Installer: Salesforce"
        "--keychain" "${OSX_KEYCHAIN}"
    )
fi

# shellcheck disable=SC2086
pkgbuild --root "$WORKSPACE_DIR" \
    --identifier com.salesforce.developer.cli \
    --install-location "/usr/local/lib/$BIN_NAME" \
    --version "${VERSION}" \
    --scripts "$ROOT_DIR/resources/darwin" \
    "${extra_args[@]+"${extra_args[@]}"}" \
    "tmp/$PKG_NAME.pkg"
