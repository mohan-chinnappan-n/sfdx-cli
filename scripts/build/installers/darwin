#!/usr/bin/env bash

set -ex

export OS=darwin
export ARCH=x64

source ./scripts/_init

keychain=""

if [[ ! -z "${OSX_KEYCHAIN:-}" ]]; then
    keychain="--keychain ${OSX_KEYCHAIN}"
fi

# shellcheck disable=SC2086
pkgbuild --root "$WORKSPACE_DIR" \
    --identifier com.salesforce.developer.cli \
    --install-location "/usr/local/lib/$BIN_NAME" \
    --version "${VERSION}" \
    --sign "Developer ID Installer: Salesforce" \
    --scripts "$ROOT_DIR/resources/darwin" \
    "$keychain" \
    "tmp/$PKG_NAME.pkg"
