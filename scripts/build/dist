#!/usr/bin/env bash

source ./scripts/_init

set -ex

if [[ ! -z "${S3_PROFILE:-}" ]]; then
    yarn config set registry $NPM_REGISTRY
    npm config set registry $NPM_REGISTRY
fi
yarn install --pure-lockfile --non-interactive

# Build cli-engine only if it is a git checkout
if [ ! -d "${ROOT_DIR}/node_modules/cli-engine/lib" ]; then
    cd "${ROOT_DIR}/node_modules/cli-engine" && yarn && cd "$ROOT_DIR"
fi
