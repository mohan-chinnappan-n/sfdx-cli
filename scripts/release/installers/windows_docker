#!/usr/bin/env bash

set -ex

source ./scripts/release/_init

if [[ "${DOCKER_DEBUG:-}" != "true" ]]; then
    set +x
fi

<<<<<<< HEAD
extra_args=()
if [[ "$USER" == "jenkins" ]]; then
    extra_args+=(
        "-v" "/etc/passwd:/etc/passwd"
        "-v" "/etc/group:/etc/group"
        "-u" $(id -u):$(id -g)
    )
fi

=======
>>>>>>> master
docker run \
    ${extra_args[@]+${extra_args[@]}} \
    --rm \
<<<<<<< HEAD
    -v "$ROOT_DIR:/home/sfdx" \
    -w /home/sfdx \
=======
    -v "$ROOT_DIR:/root/sfdx" \
    -w /root/sfdx \
>>>>>>> master
    -e CHANNEL \
    -e DISABLE_YARNCLEAN \
    -e FORCE_BUILD \
    -e http_proxy \
    -e HTTP_PROXY \
    -e https_proxy \
    -e HTTPS_PROXY \
    -e NO_PROXY \
    -e NPM_REGISTRY \
    -e PARALLEL_OS_BUILDS \
    -e S3_ACCESS_KEY \
    -e S3_SECRET \
    -e S3_ENDPOINT \
    -e S3_BUCKET \
    -e S3_REGION \
    -e SKIP_AWS \
<<<<<<< HEAD
=======
    -e "USERID=$UID" \
>>>>>>> master
    -e WINDOWS_SIGNING_KEY \
    -e WINDOWS_SIGNING_PASS \
    --entrypoint scripts/release/installers/windows \
    dickeyxxx/cli-engine-docker-nsis:v3.0.3
