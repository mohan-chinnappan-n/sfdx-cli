#!/usr/bin/env node

// tslint:disable:no-var-requires

// Check node version before requiring additional packages
require('../dist/versions').checkNodeVersion();

// Collect module loading diagnostics if enabled
const modules = require('../dist/util/modules').start();

// Pre-process/prune flags before creating or running the actual CLI
require('../dist/flags').processCliFlags(process);

const cli = require('../dist/cli');
const pjson = require('../package.json');

// OVERRIDES gets replaced with particular values for binary builds,
// but simply use defaults for npm and local invocations.
const overrides = { /* @OVERRIDES@ */ };
const version = overrides.version || pjson.version;
const channel = overrides.channel || 'stable';

cli.create(version, channel).run()
    .then(modules.dump, modules.dump)
    .then(require('@oclif/command/flush'))
    .catch(require('@oclif/errors/handle'));
